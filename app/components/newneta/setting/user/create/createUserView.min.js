angular.module("altairApp").controller("createUserCtrl",function($rootScope,$scope,$interval,$timeout,$compile,$log,ReconstructMenu,$filter,get_menu_roles_list,CreateUserFactory){ReconstructMenu.Init();var $formCreateUser=$("#form_create_user");$formCreateUser.parsley().on("form:validated",function(){$scope.$apply()}).on("field:validated",function(parsleyField){$(parsleyField.$element).hasClass("md-input")&&$scope.$apply()}),$scope.user={username:"",password:"",startDate:null,endDate:null,enable:!1,expired:!1,credentialExpired:!1,firstname:"",middlename:"",lastname:"",address:[],phone:[],mobilephone:[],fax:[],email:"",re_password:"",selectedMenuRoles:""},$scope.startdate=null,$scope.enddate=null,$scope.notification={password_validation_wrong:!1,password_validation_right:!1},$scope.listRolesMenu=[],$scope.selectedRolesMenu={};var rolesMenu={id:"",title:"",value:""},InitListMenuRoles=function(){angular.forEach(get_menu_roles_list,function(value,key){rolesMenu={id:"",title:"",value:""},rolesMenu.id=key,rolesMenu.title=value.rolesName,rolesMenu.value=value.menuRolesId,$scope.listRolesMenu.push(rolesMenu)})};InitListMenuRoles(),$scope.selectize_a_config={plugins:{disable_options:{disableOptions:["a1","c2"]}},create:!1,maxItems:1,placeholder:"Select one...",optgroupField:"parent_id",optgroupLabelField:"title",optgroupValueField:"ogid",valueField:"value",labelField:"title",searchField:"title"},$scope.changeDate=function(action,date){var myDate=null,pattern=/(\d{4})(\d{2})(\d{2})/;"start"==action?(myDate=new Date(date.replace(pattern,"$1-$2-$3")),$scope.user.startDate=myDate):"end"==action&&(myDate=new Date(date.replace(pattern,"$1-$2-$3")),$scope.user.endDate=myDate)},$scope.StartValidation=function(){},$scope.PassValidation=function(){$scope.user.password!=$scope.user.re_password?$scope.notification.password_validation_wrong=!0:$scope.notification.password_validation_right=!0},$scope.AddData=function(action,data){"phone"===action?angular.isUndefined($filter("filter")($scope.user.phone,data)[0])&&$scope.user.phone.push(data):"mobile_phone"===action?angular.isUndefined($filter("filter")($scope.user.mobilephone,data)[0])&&$scope.user.mobilephone.push(data):"address"===action?angular.isUndefined($filter("filter")($scope.user.address,data)[0])&&$scope.user.address.push(data):"fax"===action&&angular.isUndefined($filter("filter")($scope.user.fax,data)[0])&&$scope.user.fax.push(data)},$scope.RemoveData=function(action,item){if("phone"===action){var index=$scope.user.phone.indexOf(item);$scope.user.phone.splice(index,1)}else if("mobile_phone"===action){var index=$scope.user.mobilephone.indexOf(item);$scope.user.mobilephone.splice(index,1)}else if("address"===action){var index=$scope.user.address.indexOf(item);$scope.user.address.splice(index,1)}else if("fax"===action){var index=$scope.user.fax.indexOf(item);$scope.user.fax.splice(index,1)}},$scope.SubmitData=function(){var success_user_insert=function(data){$scope.user={username:"",password:"",startDate:null,endDate:null,enable:!1,expired:!1,credentialExpired:!1,firstname:"",middlename:"",lastname:"",address:[],phone:[],mobilephone:[],fax:[],email:"",re_password:"",selectedMenuRoles:""},$scope.startdate=null,$scope.enddate=null,$scope.address="",$scope.phone="",$scope.mobile_phone="",$scope.fax="",UIkit.modal.alert("Success!")},error_user_insert=function(data){$log.error("INSERT ERROR, "+JSON.stringify(data)),UIkit.modal.alert("Success!")};CreateUserFactory.CreateUser($scope.user).then(success_user_insert,error_user_insert)}}).factory("CreateUserFactory",function($http,$q,$log,ServerConfig){var service={},user_create={method:"POST",url:ServerConfig.production+"/neta/wifiid/insert/user",headers:{},params:{}};return service.CreateUser=function(data){var deffered=$q.defer();return user_create.data=data,$http(user_create).success(function(data,status,headers){deffered.resolve(data)}).error(function(data,status){$log.error(status)}),deffered.promise},service});