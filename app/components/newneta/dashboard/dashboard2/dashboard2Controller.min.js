angular.module("altairApp").controller("dashboard2Ctrl",function($rootScope,$scope,SummaryReportFactory,$interval,$timeout,variables,$filter,$window,$compile,$log,show_config_ui_month,show_config_ui_year,show_config_ui_file_id,ReconstructMenu){function getDaysInMonth(month,year){for(var date=new Date(year,month,1),days=[];date.getMonth()===month;){var t_date=""+new Date(date).getDate(),t_date_final="";t_date_final=1===t_date.length?"0"+t_date:""+t_date,days.push(t_date_final),date.setDate(date.getDate()+1)}return days}function InitData(){var _d=new Date,_month=_d.getMonth()+1,_year=_d.getFullYear(),t_month=""+_month;1==t_month.length&&(t_month="0"+_month);var _yearMonth=""+_year+t_month;$scope.notification.mainTable=!0,$scope.selectedYear=""+_year,$scope.selectedMonth=""+t_month,$scope.selectedFileId=""+$scope.listFileId[0],$scope.selectedTarget=""+$scope.listDataName[0].value;var temp={dateHour:_yearMonth,fileId:$scope.listFileId[0],dataTargetName:$scope.listDataName[0].value};listDays=$scope.listDays=getDaysInMonth(parseInt(t_month)-1,parseInt(_year)),SummaryReportFactory.SummaryCompletenessReport(temp).then(function(data){var test_data=$scope.test_data=[];angular.forEach(listDays,function(days){test_data[days]=[],angular.forEach(listHours,function(hours){var _temp_var=$filter("filter")(data,{dateHour:_year+t_month+days+hours})[0];test_data[days][hours]=_temp_var})})},function(data){})}ReconstructMenu.Init();var listDays=$scope.listDays=[],listHours=$scope.listHours=["00","01","02","03","04","05","06","07","08","09","20","21","22","23"];$scope.dash_chart={x:["hour"],y:["count"]};var c3chart_test="c3_chart_spline_test";if($("#"+c3chart_test).length){c3.generate({bindto:"#"+c3chart_test,data:{columns:[],type:"spline"},axis:{x:{type:"category",categories:listHours}}})}var c3chart_spline_id="c3_chart_spline";if($("#"+c3chart_spline_id).length){var c3chart_spline=c3.generate({bindto:"#"+c3chart_spline_id,data:{columns:[$scope.dash_chart.x,$scope.dash_chart.y],type:"spline"},color:{pattern:["#5E35B1","#FB8C00"]}});$($window).on("debouncedresize",c3chart_spline.resize()),$scope.$on("$destroy",function(){$($window).off("debouncedresize",c3chart_spline.resize()),c3chart_spline.destroy()})}$scope.notification={select:!0,mainTable:!1,errorMsg:!1,viewDetail:!1},$scope.selectedData={_id:"1",dateHour:"",fileId:"",fileOutputId:"",dataTargetName:"",date:"",hour:"",count:0,outputFiles:[]},$scope.listYears=show_config_ui_year,$scope.listMonth=show_config_ui_month,$scope.listFileId=show_config_ui_file_id,$scope.listDataName=[{id:1,title:"TSEL",value:"TSEL"},{id:2,title:"DWH",value:"DWH"},{id:3,title:"BOINGO",value:"BOINGO"},{id:4,title:"SAMSUNG",value:"SAMSUNG"},{id:5,title:"RADNET",value:"RADNET"},{id:5,title:"IPASS_1",value:"IPASS_1"},{id:5,title:"IPASS_2",value:"IPASS_2"},{id:5,title:"NUSANET",value:"NUS"}],$scope.selectize_a_config={plugins:{disable_options:{disableOptions:["c1","c2"]}},create:!1,maxItems:1,placeholder:"Select...",optgroupField:"parent_id",optgroupLabelField:"title",optgroupValueField:"ogid",valueField:"value",labelField:"title",searchField:"title"};$scope.test_data=[];$scope.submit=function(v_year,v_month,v_fileId,v_dataTargetName){if(null==v_year||null==v_month||null==v_fileId||null==v_dataTargetName)$scope.notification.errorMsg=!0;else{$scope.notification.errorMsg=!1,$scope.notification.mainTable=!0;var temp={dateHour:v_year+v_month,fileId:v_fileId,dataTargetName:v_dataTargetName};listDays=$scope.listDays=getDaysInMonth(parseInt(v_month)-1,parseInt(v_year)),SummaryReportFactory.SummaryCompletenessReport(temp).then(function(data){var test_data=$scope.test_data=[];angular.forEach(listDays,function(days){test_data[days]=[],angular.forEach(listHours,function(hours){var val_test=$filter("filter")(data,{dateHour:v_year+v_month+days+hours})[0];test_data[days][hours]=val_test})})},function(data){})}},$scope.showDetail=function(data){$scope.selectedData=data,$scope.notification.mainTable=!1,$scope.notification.viewDetail=!0},$scope.backToSearch=function(){$scope.notification.mainTable=!0,$scope.notification.viewDetail=!1,$scope.selectedData={}},InitData(),$scope.$on("onLastRepeat",function(scope,element,attrs){function createPageSelectize(){selectizeObj=$("select.ts_gotoPage").val($("select.ts_gotoPage option:selected").val()).after('<div class="selectize_fix"></div>').selectize({hideSelected:!0,onDropdownOpen:function($dropdown){$dropdown.hide().velocity("slideDown",{duration:200,easing:variables.easing_swiftOut})},onDropdownClose:function($dropdown){$dropdown.show().velocity("slideUp",{duration:200,easing:variables.easing_swiftOut}),$(".uk-tooltip").hide()}})}var $ts_pager_filter=$("#ts_pager_filter"),$ts_align=$("#ts_align"),$ts_customFilters=$("#ts_custom_filters"),$columnSelector=$("#columnSelector");if($(element).closest($ts_pager_filter).length){var pagerOptions={container:$(".ts_pager"),output:"{startRow} - {endRow} / {filteredRows} ({totalRows})",fixedHeight:!0,removeRows:!1,cssGoto:".ts_gotoPage"};$.tablesorter.language.button_print="Print table",$.tablesorter.language.button_close="Cancel",$("#printTable").on("click",function(e){e.preventDefault(),$ts_pager_filter.trigger("printTable")});var ts_users=$ts_pager_filter.tablesorter({theme:"altair",widthFixed:!0,widgets:["zebra","filter","print","columnSelector"],headers:{0:{sorter:!1,parser:!1}},widgetOptions:{columnSelector_container:$columnSelector,columnSelector_name:"data-name",columnSelector_layout:'<li class="padding_md"><input type="checkbox"><label class="inline-label">{name}</label></li>',columnSelector_saveColumns:!1,print_title:"",print_dataAttrib:"data-name",print_rows:"f",print_columns:"s",print_extraCSS:"",print_styleSheet:"",print_now:!0,print_callback:function(config,$table,printStyle){$rootScope.primarySidebarActive=!1,$rootScope.primarySidebarOpen=!1,$timeout(function(){$.tablesorter.printTable.printOutput(config,$table.html(),printStyle)},300)}}}).tablesorterPager(pagerOptions).on("pagerComplete",function(e,filter){"undefined"!=typeof selectizeObj&&selectizeObj.data("selectize")&&(selectizePage=selectizeObj[0].selectize,selectizePage.setValue($("select.ts_gotoPage option:selected").index()+1,!1))});$columnSelector.children("li").each(function(index){var $this=$(this),id=0==index?"auto":index;$this.children("input").attr("id","column_"+id),$this.children("label").attr("for","column_"+id),$this.children("input").prop("checked",!0).iCheck({checkboxClass:"icheckbox_md",radioClass:"iradio_md",increaseArea:"20%"}),0!=index&&$this.find("input").on("ifChanged",function(ev){$(ev.target).toggleClass("checked").change()})}),$("#column_auto").on("ifChecked",function(ev){$(this).closest("li").siblings("li").find("input").iCheck("disable"),$(ev.target).removeClass("checked").change()}).on("ifUnchecked",function(ev){$(this).closest("li").siblings("li").find("input").iCheck("enable"),$(ev.target).addClass("checked").change()}),createPageSelectize(),$(".pagesize.ts_selectize").after('<div class="selectize_fix"></div>').selectize({hideSelected:!0,onDropdownOpen:function($dropdown){$dropdown.hide().velocity("slideDown",{duration:200,easing:variables.easing_swiftOut})},onDropdownClose:function($dropdown){$dropdown.show().velocity("slideUp",{duration:200,easing:variables.easing_swiftOut}),$(".uk-tooltip").hide(),"undefined"!=typeof selectizeObj&&selectizeObj.data("selectize")&&(selectizePage=selectizeObj[0].selectize,selectizePage.destroy(),$(".ts_gotoPage").next(".selectize_fix").remove(),setTimeout(function(){createPageSelectize()}))}}),$(".ts_checkbox_all").iCheck({checkboxClass:"icheckbox_md",radioClass:"iradio_md",increaseArea:"20%"}).on("ifChecked",function(){$ts_pager_filter.find(".ts_checkbox").prop("checked",!0).iCheck("update").closest("tr").addClass("row_highlighted")}).on("ifUnchecked",function(){$ts_pager_filter.find(".ts_checkbox").prop("checked",!1).iCheck("update").closest("tr").removeClass("row_highlighted")}),$ts_pager_filter.find(".ts_checkbox").on("ifUnchecked",function(){$(this).closest("tr").removeClass("row_highlighted"),$(".ts_checkbox_all").prop("checked",!1).iCheck("update")}).on("ifChecked",function(){$(this).closest("tr").addClass("row_highlighted")}),$ts_pager_filter.on("click",".ts_remove_row",function(e){e.preventDefault();var $this=$(this);UIkit.modal.confirm("Are you sure you want to delete this user?",function(){$this.closest("tr").remove(),ts_users.trigger("update")},{labels:{Ok:"Delete"}})})}if($(element).closest($ts_align).length&&$ts_align.tablesorter({theme:"altair",widgets:["zebra","alignChar"],widgetOptions:{alignChar_wrap:"<i/>",alignChar_charAttrib:"data-align-char",alignChar_indexAttrib:"data-align-index",alignChar_adjustAttrib:"data-align-adjust"}}),$(element).closest($ts_customFilters).length){$ts_customFilters.tablesorter({theme:"altair",headerTemplate:"{content} {icon}",widgets:["zebra","filter"],widgetOptions:{filter_reset:"button.ts_cf_reset",filter_cssFilter:["","ts_cf_range","ts_cf_select_single","ts_cf_datepicker"]}}).on("apply.daterangepicker",function(){$table.trigger("search")});var slider=$(".ts_cf_range").ionRangeSlider({min:"0",max:"1000",type:"double","grid-num":"10","from-min":"10","from-max":"30",input_values_separator:" - "}).data("ionRangeSlider"),$selectize=$(".ts_cf_select_single").after('<div class="selectize_fix"></div>').selectize({hideSelected:!0,dropdownParent:"body",closeAfterSelect:!0,onDropdownOpen:function($dropdown){$dropdown.hide().velocity("slideDown",{duration:200,easing:[.4,0,.2,1]})},onDropdownClose:function($dropdown){$dropdown.show().velocity("slideUp",{duration:200,easing:[.4,0,.2,1]})}}),cf_selectize=$selectize[0].selectize,modal=UIkit.modal("#modal_daterange",{center:!0});$(".ts_cf_datepicker").on("focus",function(){modal.isActive()?modal.hide():modal.show()});var $dp_start=$("#ts_dp_start"),$dp_end=$("#ts_dp_end"),start_date=UIkit.datepicker($dp_start,{format:"MMM D, YYYY"}),end_date=UIkit.datepicker($dp_end,{format:"MMM D, YYYY"});$dp_start.on("change",function(){end_date.options.minDate=$dp_start.val()}),$dp_end.on("change",function(){start_date.options.maxDate=$dp_end.val()}),$("#daterangeApply").on("click",function(e){e.preventDefault(),modal.hide(),$(".ts_cf_datepicker").val($dp_start.val()+" - "+$dp_end.val()).change().blur()}),$("button.ts_cf_reset").on("click",function(){cf_selectize.clear(),slider.reset()})}})}).factory("SummaryReportFactory",function($http,$q,$log,ServerConfig){var service={},summary_completeness_report={method:"POST",url:ServerConfig.production+"/neta/wifiid/search/summary_completeness_report",headers:{},params:{}};return service.SummaryCompletenessReport=function(data){var deffered=$q.defer();return summary_completeness_report.data=data,$http(summary_completeness_report).success(function(data,status,headers){deffered.resolve(data)}).error(function(data,status){$log.error(status)}),deffered.promise},service});