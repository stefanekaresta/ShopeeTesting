angular.module("altairApp").controller("agentMonitoringCtrl",["$stateParams","$scope","$rootScope","ReconstructMenu","ActionProcess","$log","$window","$cookies","$state","$resource","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$filter","$compile","$http","ServerProcess","$interval","$timeout","$cookies",function($stateParams,$scope,$rootScope,ReconstructMenu,ActionProcess,$log,$window,$cookies,$state,$resource,DTOptionsBuilder,DTColumnBuilder,DTColumnDefBuilder,$filter,$compile,$http,ServerProcess,$interval,$timeout,$cookies){function reprocessData(data){var list_runnig_reprocess={method:"GET",url:ServerProcess.production+"/neta/process/get_running_reprocess_agentid",headers:{},params:{username:"",agentId:""}};list_runnig_reprocess.params.agentId=data,list_runnig_reprocess.params.username=$cookies.get("username"),console.log(JSON.stringify(list_runnig_reprocess)),$http(list_runnig_reprocess).success(function(data,status,headers){$scope.listData=data}).error(function(data,status){$log.error(status)})}function reOutputData(data){var list_runnig_reprocess={method:"GET",url:ServerProcess.production+"/neta/process/get_running_reprocess_output_agentid",headers:{},params:{username:"",agentId:""}};list_runnig_reprocess.params.agentId=data,list_runnig_reprocess.params.username=$cookies.get("username"),console.log(JSON.stringify(list_runnig_reprocess)),$http(list_runnig_reprocess).success(function(data,status,headers){$scope.listData=data}).error(function(data,status){$log.error(status)})}function reDispatchData(data){var list_runnig_reprocess={method:"GET",url:ServerProcess.production+"/neta/process/get_running_reprocess_dispatch_agentid",headers:{},params:{username:"",agentId:""}};list_runnig_reprocess.params.agentId=data,list_runnig_reprocess.params.username=$cookies.get("username"),console.log(JSON.stringify(list_runnig_reprocess)),$http(list_runnig_reprocess).success(function(data,status,headers){$scope.listData=data}).error(function(data,status){$log.error(status)})}ReconstructMenu.Init(),$scope.action=$stateParams.action,$scope.agentId=$stateParams.agentId,$scope.listData=[],"AGENT_REPROCESS"==$scope.action?$timeout(function(){console.log("after timeout, agentId : "+$scope.agentId),reprocessData($scope.agentId)},500):"AGENT_REOUTPUT"==$scope.action?$timeout(function(){console.log("after timeout"),reOutputData($scope.agentId)},500):"AGENT_REDISPATCH"==$scope.action&&$timeout(function(){console.log("after timeout"),reDispatchData($scope.agentId)},500);var auto=$interval(function(){"AGENT_REPROCESS"==$scope.action?reprocessData($scope.agentId):"AGENT_REOUTPUT"==$scope.action?reOutputData($scope.agentId):"AGENT_REDISPATCH"==$scope.action&&reDispatchData($scope.agentId)},1e3);$scope.$on("$destroy",function(){$interval.cancel(auto)})}]).factory("ActionProcess",function($timeout,$log,$http,ServerConfig,$q,ServerProcess,$cookies){var service={},list_runnig_reprocess={method:"GET",url:ServerProcess.production+"/neta/process/get_running_reprocess",headers:{},params:{}};service.GetListRunningReprocess=function(){var deffered=$q.defer();return $http(list_runnig_reprocess).success(function(data,status,headers){deffered.resolve(data)}).error(function(data,status){$log.error(status)}),deffered.promise};var list_runnig_reprocess_agent={method:"GET",url:ServerProcess.production+"/neta/process/get_running_reprocess",headers:{},params:{agentId:""}};return service.GetListRunningReprocessWithAgentId=function(agentid){var deffered=$q.defer();return list_runnig_reprocess_agent.params.agentId=agentid,$http(list_runnig_reprocess_agent).success(function(data,status,headers){deffered.resolve(data)}).error(function(data,status){$log.error(status)}),deffered.promise},service});