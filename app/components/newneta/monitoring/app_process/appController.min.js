angular.module("altairApp").controller("appCtrl",["$stateParams","$scope","ReconstructMenu","ActionProcess","$log","$window","$cookies","$state",function($stateParams,$scope,ReconstructMenu,ActionProcess,$log,$window,$cookies,$state){ReconstructMenu.Init(),$scope.dataList=[],$scope.showErrorCollect={};var success_getdata_process=function(data){$scope.dataList=data},error_getdata_process=function(data){$log.error("error get data"+data,data)};ActionProcess.GetListAgent().then(success_getdata_process,error_getdata_process),$scope.dataListManual=[];var success_getdata_process_manual=function(data){$scope.dataListManual=data},error_getdata_process_manual=function(data){$log.error("error get data"+data,data)};ActionProcess.GetListAgentManual().then(success_getdata_process_manual,error_getdata_process_manual),$scope.actionUpdateButton=function(agent,action){var success_update_data=function(data){ActionProcess.GetListAgent().then(success_getdata_process,error_getdata_process)},error_update_data=function(data){$log.error("error_msg : "+JSON.stringify(data))};ActionProcess.UpdateListAgent(agent,action,$cookies.get("username")).then(success_update_data,error_update_data)},$scope.actionShowError=function(agent,action){var success_get_data=function(data){var statusMessage="";angular.forEach(data,function(value,key){statusMessage+="fileId:"+value.fileId+"->"+value.statusMessage+";"}),UIkit.modal.alert("Error Message : "+statusMessage)},error_get_data=function(data){$log.error("error_msg : "+JSON.stringify(data)),UIkit.modal.alert("Error Message : "+data.statusMessage)};ActionProcess.GetErrorAgent().then(success_get_data,error_get_data)},$scope.actionProcessManual=function(action){$state.go("newneta.monitoring.detail",{action:action})}}]).controller("appDetailCtrl",["$stateParams","$scope","$rootScope","ReconstructMenu","ActionProcess","$log","$window","$cookies","$state","$resource","DTOptionsBuilder","DTColumnBuilder","DTColumnDefBuilder","$filter","$compile",function($stateParams,$scope,$rootScope,ReconstructMenu,ActionProcess,$log,$window,$cookies,$state,$resource,DTOptionsBuilder,DTColumnBuilder,DTColumnDefBuilder,$filter,$compile){ReconstructMenu.Init(),$rootScope.toBarActive=!0,$scope.$on("$destroy",function(){$rootScope.toBarActive=!1}),$scope.action=$stateParams.action,$scope.listData=[],$scope.listProcessed=[],$scope.notification={error:!1,errorMessage:""};var success_req_data=function(data){$scope.listData=data},error_req_data=function(data){$log.error("Error : "+JSON.stringify(data))};"AGENT_REPROCESS"==$scope.action?ActionProcess.FileQueueStatusNotNol().then(success_req_data,error_req_data):"AGENT_REOUTPUT"==$scope.action?ActionProcess.FileQueueStatusSatu().then(success_req_data,error_req_data):"AGENT_REDISPATCH"==$scope.action&&ActionProcess.FileQueueStatusSatu().then(success_req_data,error_req_data),$scope.addData=function(tmp){$scope.listProcessed.indexOf(tmp)==-1?$scope.listProcessed.push(tmp):console.log("duplicate entries")},$scope.removeData=function(tmp){var index=$scope.listProcessed.indexOf(tmp);$scope.listProcessed.splice(index,1)},$scope.startReprocess=function(){var success_starting_reprocess=function(data){},error_starting_reprocess=function(data){};if($scope.listProcessed.length>0){$scope.notification.error=!1,$scope.notification.errorMessage="";var success_agent=function(data){"AGENT_REPROCESS"==$scope.action?ActionProcess.RunMainReprocess($scope.listProcessed,data.agentId).then(success_starting_reprocess,error_starting_reprocess):"AGENT_REOUTPUT"==$scope.action?ActionProcess.RunMainReoutput($scope.listProcessed,data.agentId).then(success_starting_reprocess,error_starting_reprocess):"AGENT_REDISPATCH"==$scope.action&&ActionProcess.RunMainRedispatch($scope.listProcessed,data.agentId).then(success_starting_reprocess,error_starting_reprocess),$state.go("newneta.monitoring.process_info",{action:$scope.action,agentId:data.agentId})},error_agent=function(data){};ActionProcess.GetAgentId($scope.action).then(success_agent,error_agent)}else $scope.notification.error=!0,$scope.notification.errorMessage="Please Select Data to Process"},$scope.$on("onLastRepeat",function(scope,element,attrs){function createPageSelectize(){selectizeObj=$("select.ts_gotoPage").val($("select.ts_gotoPage option:selected").val()).after('<div class="selectize_fix"></div>').selectize({hideSelected:!0,onDropdownOpen:function($dropdown){$dropdown.hide().velocity("slideDown",{duration:200,easing:variables.easing_swiftOut})},onDropdownClose:function($dropdown){$dropdown.show().velocity("slideUp",{duration:200,easing:variables.easing_swiftOut}),$(".uk-tooltip").hide()}})}var $ts_pager_filter=$("#ts_pager_filter"),$ts_align=$("#ts_align"),$ts_customFilters=$("#ts_custom_filters"),$columnSelector=$("#columnSelector");if($(element).closest($ts_pager_filter).length){var pagerOptions={container:$(".ts_pager"),output:"{startRow} - {endRow} / {filteredRows} ({totalRows})",fixedHeight:!0,removeRows:!1,cssGoto:".ts_gotoPage"};$.tablesorter.language.button_print="Print table",$.tablesorter.language.button_close="Cancel",$("#printTable").on("click",function(e){e.preventDefault(),$ts_pager_filter.trigger("printTable")});var ts_users=$ts_pager_filter.tablesorter({theme:"altair",widthFixed:!0,widgets:["zebra","filter","print","columnSelector"],headers:{0:{sorter:!1,parser:!1}},widgetOptions:{columnSelector_container:$columnSelector,columnSelector_name:"data-name",columnSelector_layout:'<li class="padding_md"><input type="checkbox"><label class="inline-label">{name}</label></li>',columnSelector_saveColumns:!1,print_title:"",print_dataAttrib:"data-name",print_rows:"f",print_columns:"s",print_extraCSS:"",print_styleSheet:"",print_now:!0,print_callback:function(config,$table,printStyle){$rootScope.primarySidebarActive=!1,$rootScope.primarySidebarOpen=!1,$timeout(function(){$.tablesorter.printTable.printOutput(config,$table.html(),printStyle)},300)}}}).tablesorterPager(pagerOptions).on("pagerComplete",function(e,filter){"undefined"!=typeof selectizeObj&&selectizeObj.data("selectize")&&(selectizePage=selectizeObj[0].selectize,selectizePage.setValue($("select.ts_gotoPage option:selected").index()+1,!1))});$columnSelector.children("li").each(function(index){var $this=$(this),id=0==index?"auto":index;$this.children("input").attr("id","column_"+id),$this.children("label").attr("for","column_"+id),$this.children("input").prop("checked",!0).iCheck({checkboxClass:"icheckbox_md",radioClass:"iradio_md",increaseArea:"20%"}),0!=index&&$this.find("input").on("ifChanged",function(ev){$(ev.target).toggleClass("checked").change()})}),$("#column_auto").on("ifChecked",function(ev){$(this).closest("li").siblings("li").find("input").iCheck("disable"),$(ev.target).removeClass("checked").change()}).on("ifUnchecked",function(ev){$(this).closest("li").siblings("li").find("input").iCheck("enable"),$(ev.target).addClass("checked").change()}),createPageSelectize(),$(".pagesize.ts_selectize").after('<div class="selectize_fix"></div>').selectize({hideSelected:!0,onDropdownOpen:function($dropdown){$dropdown.hide().velocity("slideDown",{duration:200,easing:variables.easing_swiftOut})},onDropdownClose:function($dropdown){$dropdown.show().velocity("slideUp",{duration:200,easing:variables.easing_swiftOut}),$(".uk-tooltip").hide(),"undefined"!=typeof selectizeObj&&selectizeObj.data("selectize")&&(selectizePage=selectizeObj[0].selectize,selectizePage.destroy(),$(".ts_gotoPage").next(".selectize_fix").remove(),setTimeout(function(){createPageSelectize()}))}}),$(".ts_checkbox_all").iCheck({checkboxClass:"icheckbox_md",radioClass:"iradio_md",increaseArea:"20%"}).on("ifChecked",function(){$ts_pager_filter.find(".ts_checkbox").prop("checked",!0).iCheck("update").closest("tr").addClass("row_highlighted")}).on("ifUnchecked",function(){$ts_pager_filter.find(".ts_checkbox").prop("checked",!1).iCheck("update").closest("tr").removeClass("row_highlighted")}),$ts_pager_filter.find(".ts_checkbox").on("ifUnchecked",function(){$(this).closest("tr").removeClass("row_highlighted"),$(".ts_checkbox_all").prop("checked",!1).iCheck("update")}).on("ifChecked",function(){$(this).closest("tr").addClass("row_highlighted")}),$ts_pager_filter.on("click",".ts_remove_row",function(e){e.preventDefault();var $this=$(this);UIkit.modal.confirm("Are you sure you want to delete this user?",function(){$this.closest("tr").remove(),ts_users.trigger("update")},{labels:{Ok:"Delete"}})})}if($(element).closest($ts_align).length&&$ts_align.tablesorter({theme:"altair",widgets:["zebra","alignChar"],widgetOptions:{alignChar_wrap:"<i/>",alignChar_charAttrib:"data-align-char",alignChar_indexAttrib:"data-align-index",alignChar_adjustAttrib:"data-align-adjust"}}),$(element).closest($ts_customFilters).length){$ts_customFilters.tablesorter({theme:"altair",headerTemplate:"{content} {icon}",widgets:["zebra","filter"],widgetOptions:{filter_reset:"button.ts_cf_reset",filter_cssFilter:["","ts_cf_range","ts_cf_select_single","ts_cf_datepicker"]}}).on("apply.daterangepicker",function(){$table.trigger("search")});var slider=$(".ts_cf_range").ionRangeSlider({min:"0",max:"1000",type:"double","grid-num":"10","from-min":"10","from-max":"30",input_values_separator:" - "}).data("ionRangeSlider"),$selectize=$(".ts_cf_select_single").after('<div class="selectize_fix"></div>').selectize({hideSelected:!0,dropdownParent:"body",closeAfterSelect:!0,onDropdownOpen:function($dropdown){$dropdown.hide().velocity("slideDown",{duration:200,easing:[.4,0,.2,1]})},onDropdownClose:function($dropdown){$dropdown.show().velocity("slideUp",{duration:200,easing:[.4,0,.2,1]})}}),cf_selectize=$selectize[0].selectize,modal=UIkit.modal("#modal_daterange",{center:!0});$(".ts_cf_datepicker").on("focus",function(){modal.isActive()?modal.hide():modal.show()});var $dp_start=$("#ts_dp_start"),$dp_end=$("#ts_dp_end"),start_date=UIkit.datepicker($dp_start,{format:"MMM D, YYYY"}),end_date=UIkit.datepicker($dp_end,{format:"MMM D, YYYY"});$dp_start.on("change",function(){end_date.options.minDate=$dp_start.val()}),$dp_end.on("change",function(){start_date.options.maxDate=$dp_end.val()}),$("#daterangeApply").on("click",function(e){e.preventDefault(),modal.hide(),$(".ts_cf_datepicker").val($dp_start.val()+" - "+$dp_end.val()).change().blur()}),$("button.ts_cf_reset").on("click",function(){cf_selectize.clear(),slider.reset()})}})}]).controller("dt_individual_search",function($compile,$scope,$timeout,$resource,DTOptionsBuilder,DTColumnDefBuilder,DTColumnBuilder,ActionProcess,ServerConfig,$q,$http){function addData(tmp){console.log("Masuk ke sini"),console.log("Add : "+JSON.stringify(tmp))}function actionsHtml2(data,type,full,meta){return vm.tmp[data.id.counter]=data,'<a><i class="material-icons md-24 uk-text-primary" ng-click="vm.addData(vm.tmp['+data.id.counter+'])">&#xE148;</i></a>'}function serverData2(){var defer=$q.defer();return $http.get(ServerConfig.production+"/neta/wifiid/file_queue/status_not_1").then(function(result){defer.resolve(result.data)}),defer.promise}var vm=this;vm.listData=[],vm.tmp={},vm.dtOptions2=DTOptionsBuilder.fromFnPromise(serverData2).withDisplayLength(5).withPaginationType("full_numbers"),vm.dtColumns2=[DTColumnBuilder.newColumn("id").withTitle("ID"),DTColumnBuilder.newColumn("filenameInput").withTitle("File Name"),DTColumnBuilder.newColumn("fileId").withTitle("Host ID"),DTColumnBuilder.newColumn(null).withTitle("Actions").notSortable().renderWith(actionsHtml2)],vm.addData=addData,$scope.addData=addData}).factory("ActionProcess",function($timeout,$log,$http,ServerConfig,$q,ServerProcess,$cookies){var service={},get_agent_id={method:"GET",url:ServerProcess.production+"/neta/wifiid/get_agent_id",headers:{},params:{agentName:""}};service.GetAgentId=function(agentName){var deffered=$q.defer();return get_agent_id.params.agentName=agentName,$http(get_agent_id).success(function(data,status,headers){deffered.resolve(data)}).error(function(data,status){$log.error(status)}),deffered.promise};var get_file_queue_status_not_nol={method:"GET",url:ServerConfig.production+"/neta/wifiid/file_queue/status_not_0",headers:{}};service.FileQueueStatusNotNol=function(){var deffered=$q.defer();return $http(get_file_queue_status_not_nol).success(function(data,status,headers){deffered.resolve(data)}).error(function(data,status){$log.error(status)}),deffered.promise};var get_error_agent={method:"GET",url:ServerProcess.production+"/neta/collect/monitor_job",headers:{}};service.GetErrorAgent=function(){var deffered=$q.defer();return $http(get_error_agent).success(function(data,status,headers){deffered.resolve(data)}).error(function(data,status){$log.error(status)}),deffered.promise};var get_file_queue_status_not_satu={method:"GET",url:ServerConfig.production+"/neta/wifiid/file_queue/status_not_1",headers:{}};service.FileQueueStatusNotSatu=function(){var deffered=$q.defer();return $http(get_file_queue_status_not_satu).success(function(data,status,headers){deffered.resolve(data)}).error(function(data,status){$log.error(status)}),deffered.promise};var get_file_queue_status_all={method:"GET",url:ServerConfig.production+"/neta/wifiid/file_queue/status_all",headers:{}};service.FileQueueStatusAll=function(){var deffered=$q.defer();return $http(get_file_queue_status_all).success(function(data,status,headers){deffered.resolve(data)}).error(function(data,status){$log.error(status)}),deffered.promise};var get_file_queue_status_satu={method:"GET",url:ServerConfig.production+"/neta/wifiid/file_queue/status_1",headers:{}};service.FileQueueStatusSatu=function(){var deffered=$q.defer();return $http(get_file_queue_status_satu).success(function(data,status,headers){deffered.resolve(data)}).error(function(data,status){$log.error(status)}),deffered.promise};var get_file_queue_status_satu={method:"GET",url:ServerConfig.production+"/neta/wifiid/file_queue/status_1",headers:{}};service.FileQueueStatusSatu=function(){var deffered=$q.defer();return $http(get_file_queue_status_satu).success(function(data,status,headers){deffered.resolve(data)}).error(function(data,status){$log.error(status)}),deffered.promise};var action_running_reprocess={method:"POST",url:ServerProcess.production+"/neta/process/main_reprocess",headers:{},params:{username:"",agentId:""}};service.RunMainReprocess=function(data,agentId){var deffered=$q.defer();return action_running_reprocess.data=data,action_running_reprocess.params.username=$cookies.get("username"),action_running_reprocess.params.agentId=agentId,$http(action_running_reprocess).success(function(data,status,headers){deffered.resolve(data)}).error(function(data,status){$log.error(status)}),deffered.promise};var action_running_reoutput={method:"POST",url:ServerProcess.production+"/neta/process/main_reoutput",headers:{},params:{username:"",agentId:""}};service.RunMainReoutput=function(data,agentId){var deffered=$q.defer();return action_running_reoutput.data=data,action_running_reoutput.params.username=$cookies.get("username"),action_running_reoutput.params.agentId=agentId,$http(action_running_reoutput).success(function(data,status,headers){deffered.resolve(data)}).error(function(data,status){$log.error(status)}),deffered.promise};var action_running_redispatch={method:"POST",url:ServerProcess.production+"/neta/process/main_redispatch",headers:{},params:{username:"",agentId:""}};service.RunMainRedispatch=function(data,agentId){var deffered=$q.defer();return action_running_redispatch.data=data,action_running_redispatch.params.username=$cookies.get("username"),action_running_redispatch.params.agentId=agentId,$http(action_running_redispatch).success(function(data,status,headers){deffered.resolve(data)}).error(function(data,status){$log.error(status)}),deffered.promise};var file_type_detail_input_custom={method:"POST",url:ServerConfig.production+"/neta/wifiid/search/file_queue_custom_status",headers:{},params:{}};service.FileQueueCustom=function(data){var deffered=$q.defer();return file_type_detail_input_custom.data=data,$http(file_type_detail_input_custom).success(function(data,status,headers){deffered.resolve(data)}).error(function(data,status){$log.error(status)}),deffered.promise};var agent_process={method:"GET",url:ServerConfig.production+"/neta/wifiid/agent/list_agent?action=FROM_SCH",headers:{}};service.GetListAgent=function(){var deffered=$q.defer();return $http(agent_process).success(function(data,status,headers){deffered.resolve(data)}).error(function(data,status){$log.error(status)}),deffered.promise};var agent_process_manual={method:"GET",url:ServerConfig.production+"/neta/wifiid/agent/list_agent?action=MANUAL_ACTION",headers:{}};service.GetListAgentManual=function(){var deffered=$q.defer();return $http(agent_process_manual).success(function(data,status,headers){deffered.resolve(data)}).error(function(data,status){$log.error(status)}),deffered.promise};var agent_process_update={method:"GET",url:ServerConfig.production+"/neta/wifiid/agent/update_list_agent",headers:{},params:{agentName:"",action:"",username:""}};return service.UpdateListAgent=function(agent,action,username){var deffered=$q.defer();return agent_process_update.params.agentName=agent,agent_process_update.params.action=action,agent_process_update.params.username=username,$http(agent_process_update).success(function(data,status,headers){deffered.resolve(data)}).error(function(data,status){$log.error(status)}),deffered.promise},service});