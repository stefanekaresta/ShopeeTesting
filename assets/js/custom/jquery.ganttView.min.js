!function(e){function t(t){function a(){var t=Math.floor(r.slideWidth/r.cellWidth+5),a=l.getBoundaryDatesFromData(r.data,t);r.start||(r.start=a[0]),r.recovery=r.data,r.end=a[1],i.each(function(){var t=e(this),a=e("<div>",{"class":"ganttview"});new d(a,r).render(),t.append(a);e("div.ganttview-vtheader",t).outerWidth()+e("div.ganttview-slide-container",t).outerWidth();t.css("width","100%"),new v(t,r).apply()})}var i=this,n={showWeekends:!0,cellHeight:31,slideWidth:400,vHeaderWidth:100,behavior:{clickable:!0,draggable:!0,resizable:!0,hover:!0},additionalRows:4},r=e.extend(!0,n,t);r.data?a():r.dataUrl&&e.getJSON(r.dataUrl,function(e){r.data=e,a()})}function a(e,t){if("setSlideWidth"==e){var a=$("div.ganttview",this);a.each(function(){$("div.ganttview-vtheader",a).outerWidth();$(a).width("100%"),$("div.ganttview-slide-container",this).width(t)})}}function i(e){for(var t=0;t<e.length;t++)for(var a=0;a<e[t].series.length;a++)n(e[t],e[t].series[a],a)}function n(e,t,a){for(var i=0;i<t.activities.length;i++)for(var n=i+1;n<t.activities.length;n++)i!=n&&r(t.activities[i].start,t.activities[i].end,t.activities[n].start,t.activities[n].end)&&(s.push(t.activities[n]),t.activities.splice(n,1),n--,0!=i&&i--);s.length>0&&(e.series.splice(a+1,0,{name:"",activities:s}),s=new Array)}function r(e,t,a,i){return Date.parse(a)>=Date.parse(e)&&Date.parse(a)<=Date.parse(t)||Date.parse(i)>=Date.parse(e)&&Date.parse(i)<=Date.parse(t)}e.fn.ganttView=function(){var e=Array.prototype.slice.call(arguments);1==e.length&&"object"==typeof e[0]&&t.call(this,e[0]),2==e.length&&"string"==typeof e[0]&&a.call(this,e[0],e[1])};var s=new Array,d=function(t,a){function n(){i(a.data),s(t,a.data,a.cellHeight);var n=e("<div>",{"class":"ganttview-slide-container"});"Y/M"==a.viewType&&null==a.cellWidth?a.cellWidth=2:"Y/M/D"==a.viewType&&null==a.cellWidth&&(a.cellWidth=21),dates=r(a.start,a.end),d(n,dates,a.cellWidth),v(n,a.data,dates,a.cellWidth,a.showWeekends,a.additionalRows),o(n,a.data,a.additionalRows),c(n,a.data,a.cellWidth,a.start,a),t.append(n),p(t.parent())}function r(e,t){var a=[];a[e.getFullYear()]=[],a[e.getFullYear()][e.getMonth()]=[e];for(var i=e;i.compareTo(t)==-1;){var n=i.clone().addDays(1);a[n.getFullYear()]||(a[n.getFullYear()]=[]),a[n.getFullYear()][n.getMonth()]||(a[n.getFullYear()][n.getMonth()]=[]),a[n.getFullYear()][n.getMonth()].push(n),i=n}return a}function s(t,i,n){for(var r=e("<div>",{"class":"ganttview-vtheader"}),s=0;s<i.length;s++){var d=e("<div>",{"class":"ganttview-vtheader-item"});d.append(e("<div>",{id:"ganttview-header-"+i[s].Id,"class":"ganttview-vtheader-item-name",css:{"min-height":i[s].series.length*n-1+"px"}}).append(i[s].name));for(var v=e("<div>",{"class":"ganttview-vtheader-series"}),l=0;l<i[s].series.length;l++){var o="ganttview-vtheader-series-name";""==i[s].series[l].name&&(o="ganttview-vtheader-series-overlapping"),v.append(e("<div>",{"class":o,css:{"min-height":n+"px"}}).append(i[s].series[l].name))}d.append(v),r.append(d)}t.append(r),"Y/M/D"==a.viewType&&r.css("margin-top","41px")}function d(t,i,n){var r=e("<div>",{"class":"ganttview-hzheader"}),s=e("<div>",{"class":"ganttview-hzheader-months"}),d=e("<div>",{"class":"ganttview-hzheader-days"}),v=0;for(var l in i){if("Y/M"==a.viewType){var o=0;for(var c in i[l])o+=i[l][c].length;o*=n,s.append(e("<div>",{"class":"ganttview-hzheader-month",css:{width:o-1+"px"}}).append(l))}for(var c in i[l]){var o=i[l][c].length*n;if("Y/M"==a.viewType)v=v+o+1,d.append(e("<div>",{"class":"ganttview-hzheader-month",css:{width:o-1+"px"}}).append(g[c]));else if("Y/M/D"==a.viewType){v+=o,s.append(e("<div>",{"class":"ganttview-hzheader-month",css:{width:o-1+"px"}}).append(l+"/"+g[c]));for(var h in i[l][c])d.append(e("<div>",{"class":"ganttview-hzheader-day"}).append(i[l][c][h].getDate()))}}}s.css("width",v+"px"),d.css("width",v+"px"),r.append(s).append(d),t.append(r)}function v(t,i,n,r,s,d){var v=e("<div>",{"class":"ganttview-grid"}),o=e("<div>",{"class":"ganttview-grid-row"}),c=0;for(var h in n)for(var p in n[h])if("Y/M"==a.viewType){var g=n[h][p].length*r;c+=n[h][p].length;var w=e("<div>",{"class":"ganttview-grid-row-cell"});w.css("width",g-1+"px"),o.append(w),p%2==0&&w.addClass("ganttview-weekend")}else if("Y/M/D"==a.viewType)for(var f in n[h][p]){var w=e("<div>",{"class":"ganttview-grid-row-cell"});l.isWeekend(n[h][p][f])&&s&&w.addClass("ganttview-weekend"),o.append(w)}var g=r*c;"Y/M/D"==a.viewType&&(g=e("div.ganttview-grid-row-cell",o).length*r),o.css("width",g+"px"),v.css("width",g+"px");for(var u=0;u<i.length;u++)for(var b=0;b<i[u].series.length;b++)v.append(o.clone());for(var u=0;u<d;u++)v.append(o.clone());t.append(v)}function o(t,a,i){for(var n=e("<div>",{"class":"ganttview-blocks"}),r=0;r<a.length;r++)for(var s=0;s<a[r].series.length;s++){var d=e("<div>",{"class":"ganttview-series-container"}).appendTo(n);$(d).append(e("<div>",{"class":"ganttview-block-container"}))}for(var r=0;r<i;r++){var d=e("<div>",{"class":"ganttview-Series-container"}).appendTo(n);$(d).append(e("<div>",{"class":"ganttview-block-container"}))}t.append(n)}function c(t,a,i,n,r){for(var s=e("div.ganttview-blocks div.ganttview-block-container",t),d=0,v=0;v<a.length;v++)for(var o=0;o<a[v].series.length;o++){for(var c=a[v].series[o],p=0;p<c.activities.length;p++){var g=a[v].series[o].activities[p];if(""!=g.start&&""!=g.end&&Date.parse(g.end)>=n){var w=l.daysBetween(g.start,g.end)+1,f=Date.parse(g.start);if(f>=n)var u=l.daysBetween(n,f);else var u=-l.daysBetween(f,n);var b=2,y=0;"Y/M/D"==r.viewType&&(b=9,y=3);var D=e("<div>",{"class":"tooltip ganttview-block",css:{width:w*i-b+"px","margin-left":u*i+y+"px"}});g.color&&D.css("background-color",g.color),h(D,a[v],c,g),null!=r.titleFormater?(g.title=r.titleFormater(g,w),D.append(e("<div>",{"class":"ganttview-block-text"}).html(g.title))):D.append(e("<div>",{"class":"ganttview-block-text"}).text(w)),e(s[d]).append(D)}}d+=1}}function h(t,a,i,n){var r={Id:a.Id,name:a.name};e.extend(r,i),e.extend(r,n),t.data("block-data",r)}function p(t){e("div.ganttview-grid-row div.ganttview-grid-row-cell:last-child",t).addClass("last"),e("div.ganttview-hzheader-days div.ganttview-hzheader-day:last-child",t).addClass("last"),e("div.ganttview-hzheader-months div.ganttview-hzheader-month:last-child",t).addClass("last")}var g=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];return{render:n}},v=function(t,a){function i(){a.behavior.clickable&&n(t,a.behavior.onClick),a.behavior.resizable&&s(t,a.cellWidth,a.start,a.behavior.onResize),a.behavior.draggable&&d(t,a.cellWidth,a.start,a.behavior.onDrag),a.behavior.hover&&r(t,a.behavior.onHover,a.behavior.onLeave)}function n(t,a){e("div.ganttview-block",t).on("click",function(){a&&a(e(this).data("block-data"))})}function r(t,a,i){e("div.ganttview-block",t).on("mouseover mouseout",function(t){"mouseover"==t.type?a&&a(e(this),e(this).data("block-data")):i&&i(e(this),e(this).data("block-data"))})}function s(t,a,i,n){e("div.ganttview-block",t).resizable({grid:a,handles:"e,w",stop:function(){var r=e(this);v(t,r,a,i),n&&n(r.data("block-data"))}})}function d(t,a,i,n){e("div.ganttview-block",t).draggable({axis:"x",grid:[a,a],stop:function(){var r=e(this);v(t,r,a,i),n&&n(r.data("block-data"))}})}function v(t,a,i,n){var r=e("div.ganttview-slide-container",t),s=r.scrollLeft(),d=a.offset().left-r.offset().left-1+s,v=Math.round(d/i),l=n.clone().addDays(v);a.data("block-data").start=l;var o=a.outerWidth(),c=Math.round(o/i)-1;a.data("block-data").end=l.clone().addDays(c),e("div.ganttview-block-text",a).text(c+1),a.css("top","").css("left","").css("margin-left",d+"px")}return{apply:i}},l={daysBetween:function(e,t){if(!e||!t)return 0;if(e=Date.parse(e),t=Date.parse(t),1901==e.getYear()||8099==t.getYear())return 0;for(var a=0,i=e.clone();i.compareTo(t)==-1;)a+=1,i.addDays(1);return a},isWeekend:function(e){return e.getDay()%6==0},getBoundaryDatesFromData:function(e,t){for(var a=new Date,i=new Date,n=0;n<e.length;n++)for(var r=0;r<e[n].series.length;r++)for(var s=0;s<e[n].series[r].activities.length;s++)if(""!=e[n].series[r].activities[s].start&&""!=e[n].series[r].activities[s].end){var d=Date.parse(e[n].series[r].activities[s].start),v=Date.parse(e[n].series[r].activities[s].end);0==n&&0==r&&0==s&&(a=d,i=v),a>d&&(a=d),i<v&&(i=v)}return l.daysBetween(a,i)<t&&(i=a.clone().addDays(t)),a=new Date(a.getFullYear(),a.getMonth(),1),[a,i]}}}(jQuery);